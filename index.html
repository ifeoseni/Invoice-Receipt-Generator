<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Professional Invoice & Receipt Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f7f9fc;
        color: #333;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2,
      h3 {
        margin: 0 0 10px 0;
        color: #2c3e50;
      }
      h1 {
        text-align: center;
        font-size: 28px;
      }
      .subtitle {
        text-align: center;
        color: #7f8c8d;
        font-size: 15px;
        margin-bottom: 30px;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .form-group {
        margin-bottom: 18px;
      }
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #2c3e50;
        font-size: 14px;
      }
      input,
      select,
      button {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      th,
      td {
        border: 1px solid #000;
        padding: 10px;
        text-align: left;
      }
      th {
        background-color: #f8f9fa;
        color: #2c3e50;
      }
      .total-row td {
        font-weight: bold;
      }
      .logo-preview {
        max-width: 180px;
        margin-top: 10px;
        border: 1px solid #eee;
        border-radius: 8px;
      }
      .action-buttons {
        text-align: center;
        margin: 25px 0;
      }
      .action-buttons button {
        padding: 12px 24px;
        margin: 0 10px;
        width: auto;
        font-size: 16px;
      }
      .info-box {
        background: #d4edda;
        padding: 14px;
        border-radius: 8px;
        font-size: 14px;
        color: #155724;
        line-height: 1.5;
        margin-bottom: 15px;
        border: 1px solid #c3e6cb;
        font-weight: bold;
      }

      /* Customization Panel */
      .customization-panel {
        background: #f1f8ff;
        border-radius: 8px;
        padding: 20px;
        margin: 25px 0;
        border: 1px solid #d1e7ff;
      }

      .customization-section {
        margin-bottom: 20px;
      }

      .customization-section h3 {
        margin-top: 0;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 5px;
      }

      .customization-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .style-option {
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        background: white;
      }

      .style-option:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .style-option.selected {
        border-color: #3498db;
        background-color: #e1f0fa;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
      }

      .style-preview {
        height: 100px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
      }

      .style-name {
        font-size: 14px;
        font-weight: 600;
      }

      .customization-description {
        font-size: 13px;
        color: #7f8c8d;
        margin-top: 5px;
        font-style: italic;
      }

      /* Back Button */
      .back-button {
        background: #95a5a6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 10px;
        display: inline-flex;
        align-items: center;
      }

      .back-button:hover {
        background: #7f8c8d;
      }

      .back-button i {
        margin-right: 5px;
      }

      /* Print Styles */
      @media print {
        body * {
          visibility: hidden !important;
        }
        #invoiceOutput,
        #invoiceOutput * {
          visibility: visible !important;
        }
        #invoiceOutput {
          position: absolute !important;
          left: 0;
          top: 0;
          width: 100% !important;
          padding: 15px !important;
          margin: 0 !important;
          border: 3px double #000 !important;
          background: white !important;
        }
        @page {
          margin: 0.7cm;
          size: A4;
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  </head>
  <body>
    <!-- This will be printed -->
    <div id="invoiceOutput" style="display: none"></div>

    <!-- Main App -->
    <div id="appUI" class="container">
      <h1>📄 Professional Invoice & Receipt Generator</h1>
      <p class="subtitle">
        Create beautiful, customizable documents - no data stored
      </p>

      <!-- Business & Customer -->
      <div class="grid-2">
        <div>
          <h3>💼 Your Business</h3>
          <div class="form-group">
            <label>Business Name</label>
            <input type="text" id="businessName" placeholder="Your Company" />
          </div>
          <div class="form-group">
            <label>Logo (Optional)</label>
            <input type="file" id="logoUpload" accept="image/*" />
            <img id="logoPreview" class="logo-preview" style="display: none" />
          </div>
          <div class="form-group">
            <label>Logo Alignment</label>
            <select id="logoAlign">
              <option value="left">Left</option>
              <option value="center">Center</option>
              <option value="right">Right</option>
            </select>
          </div>
        </div>

        <div>
          <h3>📬 Customer Details</h3>
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="customerName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              type="email"
              id="customerEmail"
              placeholder="john@example.com"
            />
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input
              type="text"
              id="customerPhone"
              placeholder="+234 801 234 5678"
            />
          </div>
          <div class="form-group">
            <label>Address</label>
            <input
              type="text"
              id="customerAddress"
              placeholder="Lagos, Nigeria"
            />
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div class="grid-2" style="margin: 25px 0">
        <div>
          <div class="form-group">
            <label>Document Type</label>
            <select id="docType">
              <option value="invoice">Invoice</option>
              <option value="receipt">Receipt</option>
            </select>
          </div>
          <div class="form-group">
            <label>Document Number</label>
            <input type="text" id="invoiceNumber" value="INV-001" />
          </div>
        </div>
        <div>
          <div class="form-group">
            <label>Currency</label>
            <select id="currencySelect">
              <option value="$">USD ($)</option>
              <option value="₦">NGN (₦)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Due Date (Invoice only)</label>
            <input type="date" id="dueDate" />
          </div>
        </div>
      </div>

      <!-- Add Product -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px">
        <h3>➕ Add Item</h3>
        <div
          style="display: grid; gap: 15px; grid-template-columns: 2fr 1fr 1fr"
        >
          <div>
            <label>Item</label>
            <input type="text" id="productName" placeholder="Web Design" />
          </div>
          <div>
            <label>Qty</label>
            <input type="number" id="productQty" value="1" min="1" />
          </div>
          <div>
            <label>Unit Price</label>
            <input
              type="number"
              id="productPrice"
              step="0.01"
              placeholder="5000"
            />
          </div>
        </div>
        <button id="addProduct" style="margin-top: 15px; width: 100%">
          ➕ Add to List
        </button>
      </div>

      <!-- Product Table -->
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Unit Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="productList"></tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="3" style="text-align: right">Total Amount:</td>
            <td id="totalAmount">$0.00</td>
          </tr>
        </tfoot>
      </table>

      <!-- Customization Panel -->
      <div class="customization-panel">
        <h3>🎨 Document Customization</h3>
        <p>Customize your document appearance to match your brand identity</p>

        <!-- Style Selection -->
        <div class="customization-section">
          <h3>Style Presets</h3>
          <p>Select a professional style for your document:</p>

          <div class="customization-grid" id="styleOptions">
            <!-- Style options will be inserted here by JavaScript -->
          </div>
          <button
            id="clearStyles"
            style="
              margin-top: 10px;
              padding: 8px 15px;
              background: #e74c3c;
              color: white;
              border: none;
              border-radius: 4px;
            "
          >
            Clear Selection
          </button>
        </div>

        <!-- Color Customization -->
        <div class="customization-section">
          <h3>Color Customization</h3>
          <p>Customize specific elements of your document</p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div>
              <label>Header Color</label>
              <input type="color" id="headerColor" value="#3498db" />
              <div class="customization-description">
                Changes the color of document headers and titles
              </div>
            </div>
            <div>
              <label>Text Color</label>
              <input type="color" id="textColor" value="#2c3e50" />
              <div class="customization-description">
                Sets the main text color throughout the document
              </div>
            </div>
            <div>
              <label>Accent Color</label>
              <input type="color" id="accentColor" value="#1a3a6e" />
              <div class="customization-description">
                Used for important elements like totals and highlights
              </div>
            </div>
            <div>
              <label>Background Color</label>
              <input type="color" id="bgColor" value="#ffffff" />
              <div class="customization-description">
                Changes the overall document background color
              </div>
            </div>
            <div>
              <label>Border Color</label>
              <input type="color" id="borderColor" value="#000000" />
              <div class="customization-description">
                Sets the color of all document borders
              </div>
            </div>
          </div>
        </div>

        <!-- Font Customization -->
        <div class="customization-section">
          <h3>Typography</h3>
          <p>Choose fonts that match your brand style</p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div>
              <label>Font Family</label>
              <select id="fontFamily">
                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">
                  Segoe UI
                </option>
                <option value="'Helvetica Neue', Helvetica, Arial, sans-serif">
                  Helvetica Neue
                </option>
                <option value="'Times New Roman', Times, serif">
                  Times New Roman
                </option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Courier New, monospace">Courier New</option>
              </select>
              <div class="customization-description">
                Sets the primary font for all text in the document
              </div>
            </div>
            <div>
              <label>Header Font Size</label>
              <select id="headerSize">
                <option value="1.5em">Large</option>
                <option value="1.3em">Medium</option>
                <option value="1.1em">Small</option>
              </select>
              <div class="customization-description">
                Controls the size of document headings and titles
              </div>
            </div>
          </div>
        </div>

        <!-- Border Customization -->
        <div class="customization-section">
          <h3>Border Style</h3>
          <p>Customize the appearance of table and element borders</p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div>
              <label>Border Width</label>
              <select id="borderWidth">
                <option value="1px">Thin</option>
                <option value="2px" selected>Medium</option>
                <option value="3px">Thick</option>
              </select>
              <div class="customization-description">
                Controls the thickness of all document borders
              </div>
            </div>
            <div>
              <label>Border Style</label>
              <select id="borderStyle">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
              <div class="customization-description">
                Changes the visual style of document borders
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Generated By -->
      <div class="form-group">
        <label>Generated By (Your Name)</label>
        <input type="text" id="generatedBy" placeholder="Jane Smith" />
      </div>

      <!-- Generate Button -->
      <div class="action-buttons">
        <button id="generateInvoice">📄 Generate Document</button>
      </div>
    </div>

    <!-- Print / PDF Section outside appUI -->
    <div class="action-buttons" id="printSection" style="display: none">
      <div class="info-box">
        🎉 Your document is ready! Click below to print or download as PDF.
      </div>
      <button id="printInvoice" style="background: #27ae60">
        🖨️ PRINT / SAVE AS PDF
      </button>
      <button id="downloadPdf" style="background: #2980b9">
        ⬇️ DOWNLOAD PDF
      </button>
      <button id="newInvoice" style="background: #95a5a6">
        🆕 NEW DOCUMENT
      </button>
      <button id="backToEdit" class="back-button">
        <i>←</i> Edit Information
      </button>
    </div>

    <script>
      let products = [];
      let logoSrc = "";
      let selectedStyle = -1; // -1 means no selection

      // Professional style options
      const styles = [
        {
          name: "Classic Blue",
          primary: "#3498db",
          secondary: "#2c3e50",
          accent: "#1a3a6e",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Modern Green",
          primary: "#2ecc71",
          secondary: "#27ae60",
          accent: "#1e8449",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Corporate Gray",
          primary: "#95a5a6",
          secondary: "#7f8c8d",
          accent: "#34495e",
          font: "'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        {
          name: "Elegant Purple",
          primary: "#9b59b6",
          secondary: "#8e44ad",
          accent: "#7d3c98",
          font: "'Times New Roman', Times, serif",
        },
        {
          name: "Warm Orange",
          primary: "#e67e22",
          secondary: "#d35400",
          accent: "#c0392b",
          font: "'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        {
          name: "Calm Teal",
          primary: "#1abc9c",
          secondary: "#16a085",
          accent: "#148f77",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Royal Gold",
          primary: "#f1c40f",
          secondary: "#f39c12",
          accent: "#d35400",
          font: "'Georgia', serif",
        },
        {
          name: "Ocean Blue",
          primary: "#3498db",
          secondary: "#2980b9",
          accent: "#1a5276",
          font: "'Times New Roman', Times, serif",
        },
        {
          name: "Sunset Red",
          primary: "#e74c3c",
          secondary: "#c0392b",
          accent: "#a93226",
          font: "'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        {
          name: "Forest Green",
          primary: "#27ae60",
          secondary: "#219653",
          accent: "#1e8449",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
      ];

      // Initialize style options
      function initStyleOptions() {
        const container = document.getElementById("styleOptions");
        container.innerHTML = "";

        styles.forEach((style, index) => {
          const option = document.createElement("div");
          option.className = "style-option";
          if (index === selectedStyle) option.classList.add("selected");

          option.innerHTML = `
      <div class="style-preview" style="background: linear-gradient(135deg, ${style.primary}, ${style.secondary})">
        ${style.name}
      </div>
      <div class="style-name">${style.name}</div>
    `;

          option.addEventListener("click", () => {
            // Toggle selection
            if (selectedStyle === index) {
              selectedStyle = -1; // Deselect
              option.classList.remove("selected");
            } else {
              // Remove selected class from all options
              document.querySelectorAll(".style-option").forEach((el) => {
                el.classList.remove("selected");
              });

              // Add selected class to clicked option
              option.classList.add("selected");
              selectedStyle = index;
            }
          });

          container.appendChild(option);
        });
      }

      // Clear style selection
      document
        .getElementById("clearStyles")
        .addEventListener("click", function () {
          selectedStyle = -1;
          document.querySelectorAll(".style-option").forEach((el) => {
            el.classList.remove("selected");
          });
        });

      // Add Product
      document
        .getElementById("addProduct")
        .addEventListener("click", function () {
          const name = document.getElementById("productName").value.trim();
          const qty = parseInt(document.getElementById("productQty").value);
          const price = parseFloat(
            document.getElementById("productPrice").value
          );

          if (!name || isNaN(qty) || qty <= 0 || isNaN(price) || price < 0) {
            alert("Please fill all fields correctly.");
            return;
          }

          const itemTotal = qty * price;
          products.push({ name, qty, price, itemTotal });
          updateProductList();
          clearForm();
        });

      function updateProductList() {
        const tbody = document.getElementById("productList");
        tbody.innerHTML = "";
        let total = 0;
        products.forEach((p) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
      <td>${escapeHtml(p.name)}</td>
      <td>${p.qty}</td>
      <td>${getCurrency()}${p.price.toFixed(2)}</td>
      <td>${getCurrency()}${p.itemTotal.toFixed(2)}</td>`;
          tbody.appendChild(tr);
          total += p.itemTotal;
        });
        document.getElementById(
          "totalAmount"
        ).textContent = `${getCurrency()}${total.toFixed(2)}`;
      }

      function clearForm() {
        document.getElementById("productName").value = "";
        document.getElementById("productQty").value = "1";
        document.getElementById("productPrice").value = "";
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function getCurrency() {
        return document.getElementById("currencySelect").value;
      }

      // Logo Preview
      document
        .getElementById("logoUpload")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
              logoSrc = event.target.result;
              const img = document.getElementById("logoPreview");
              img.src = logoSrc;
              img.style.display = "block";
            };
            reader.readAsDataURL(file);
          }
        });

      // Format Date
      function formatDate(dateStr) {
        if (!dateStr) return null;
        return new Date(dateStr).toLocaleDateString("en-NG", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Generate Document
      document
        .getElementById("generateInvoice")
        .addEventListener("click", function () {
          if (products.length === 0) {
            alert("Please add at least one item.");
            return;
          }

          // Store current form values for potential editing
          window.formValues = {
            businessName: document.getElementById("businessName").value,
            customerName: document.getElementById("customerName").value,
            customerEmail: document.getElementById("customerEmail").value,
            customerPhone: document.getElementById("customerPhone").value,
            customerAddress: document.getElementById("customerAddress").value,
            docType: document.getElementById("docType").value,
            invoiceNumber: document.getElementById("invoiceNumber").value,
            currency: getCurrency(),
            dueDate: document.getElementById("dueDate").value,
            generatedBy: document.getElementById("generatedBy").value,
            logoSrc: logoSrc,
            logoAlign: document.getElementById("logoAlign").value,
            products: [...products],
            selectedStyle: selectedStyle,
          };

          // Get customization values
          const borderColor =
            document.getElementById("borderColor").value || "#000000";
          const headerColor =
            document.getElementById("headerColor").value ||
            (selectedStyle !== -1 ? styles[selectedStyle].primary : "#3498db");
          const textColor =
            document.getElementById("textColor").value ||
            (selectedStyle !== -1
              ? styles[selectedStyle].secondary
              : "#2c3e50");
          const accentColor =
            document.getElementById("accentColor").value ||
            (selectedStyle !== -1 ? styles[selectedStyle].accent : "#1a3a6e");
          const bgColor = document.getElementById("bgColor").value || "#ffffff";
          const fontFamily = document.getElementById("fontFamily").value;
          const headerSize = document.getElementById("headerSize").value;
          const borderWidth = document.getElementById("borderWidth").value;
          const borderStyle = document.getElementById("borderStyle").value;

          const business =
            document.getElementById("businessName").value || "Your Business";
          const customerName =
            document.getElementById("customerName").value || "Client";
          const customerEmail =
            document.getElementById("customerEmail").value || "";
          const customerPhone =
            document.getElementById("customerPhone").value || "";
          const customerAddress =
            document.getElementById("customerAddress").value || "";
          const generatedBy =
            document.getElementById("generatedBy").value || "Authorized Person";
          const currency = getCurrency();
          const docType = document.getElementById("docType").value;
          const invoiceNumber =
            document.getElementById("invoiceNumber").value || "INV-001";
          const dueDate = formatDate(document.getElementById("dueDate").value);
          const issueDate = new Date().toLocaleDateString("en-NG", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          // Handle logo positioning
          let logoHtml = "";
          if (logoSrc) {
            const logoAlign = document.getElementById("logoAlign").value;
            const alignmentStyle =
              logoAlign === "left"
                ? "text-align:left;"
                : logoAlign === "center"
                ? "text-align:center;"
                : "text-align:right;";

            logoHtml = `<div style="${alignmentStyle}margin-bottom:15px;">
      <img src="${logoSrc}" style="max-width:180px;border-radius:8px;">
    </div>`;
          }

          let customerHtml = `<strong>${escapeHtml(customerName)}</strong><br>`;
          if (customerAddress)
            customerHtml += `${escapeHtml(customerAddress)}<br>`;
          if (customerEmail) customerHtml += `${escapeHtml(customerEmail)}<br>`;
          if (customerPhone) customerHtml += `${escapeHtml(customerPhone)}<br>`;

          // Set correct title based on document type
          const docTitle = docType === "receipt" ? "RECEIPT" : "INVOICE";
          const docNumberLabel =
            docType === "receipt" ? "Receipt No." : "Invoice No.";

          const dueHtml =
            docType === "invoice" && dueDate
              ? `<p><strong>Due Date:</strong> ${dueDate}</p>`
              : "";

          let itemsHtml = "";
          const total = products.reduce((sum, p) => sum + p.itemTotal, 0);

          products.forEach((p) => {
            itemsHtml += `<tr>
      <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${escapeHtml(
              p.name
            )}</td>
      <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${
              p.qty
            }</td>
      <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${currency}${p.price.toFixed(
              2
            )}</td>
      <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${currency}${p.itemTotal.toFixed(
              2
            )}</td>
    </tr>`;
          });

          const output = document.getElementById("invoiceOutput");
          output.innerHTML = `
    <div style="font-family:${fontFamily};color:${textColor};max-width:900px;margin:auto;padding:20px;background:${bgColor};">
      ${logoHtml}
      <h2 style="color:${headerColor};text-align:center;font-size:${headerSize};">${escapeHtml(
            business
          )}</h2>
      <h1 style="text-align:center;color:${textColor};font-weight:bold;font-size:${headerSize};">${docTitle}</h1>
      <table width="100%" style="margin-bottom:20px;border:${borderWidth} ${borderStyle} ${borderColor};">
        <tr>
          <td width="50%">
            <strong style="color:${textColor};">${docNumberLabel}:</strong> ${escapeHtml(
            invoiceNumber
          )}<br>
            <strong style="color:${textColor};">Date:</strong> ${issueDate}<br>${dueHtml}
          </td>
          <td width="50%" style="text-align:right;">
            <strong style="color:${textColor};">Billed To:</strong><br>${customerHtml}
          </td>
        </tr>
      </table>
      <table style="width:100%;border-collapse:collapse;border:${borderWidth} ${borderStyle} ${borderColor};">
        <thead>
          <tr style="background:${headerColor};color:white;">
            <th style="padding:14px;border:${borderWidth} ${borderStyle} ${headerColor};">Item</th>
            <th style="padding:14px;border:${borderWidth} ${borderStyle} ${headerColor};">Qty</th>
            <th style="padding:14px;border:${borderWidth} ${borderStyle} ${headerColor};">Unit Price</th>
            <th style="padding:14px;border:${borderWidth} ${borderStyle} ${headerColor};">Total</th>
          </tr>
        </thead>
        <tbody>${itemsHtml}</tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="text-align:right;font-weight:bold;font-size:1.3em;padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">Total:</td>
            <td style="font-weight:bold;font-size:1.4em;padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};color:${accentColor};">${currency}${total.toFixed(
            2
          )}</td>
          </tr>
        </tfoot>
      </table>
      <p style="text-align:center;margin-top:30px;font-style:italic;color:#666;">
        Generated by: ${escapeHtml(generatedBy)}<br>
        Date: ${issueDate}
      </p>
      <p style="text-align:center;margin-top:10px;font-size:0.9em;color:#666;">
        Thank you for your trust and business!
      </p>
    </div>
  `;

          document.getElementById("appUI").style.display = "none";
          document.getElementById("invoiceOutput").style.display = "block";
          document.getElementById("printSection").style.display = "block";
          document
            .getElementById("printSection")
            .scrollIntoView({ behavior: "smooth" });
        });

      // Print button
      document.getElementById("printInvoice").onclick = function () {
        window.print();
      };

      // Download PDF button using html2pdf.js
      document.getElementById("downloadPdf").onclick = function () {
        const invoice = document.getElementById("invoiceOutput");
        const opt = {
          margin: 0,
          filename: "document.pdf",
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
        };
        html2pdf().set(opt).from(invoice).save();
      };

      // New document button
      document.getElementById("newInvoice").onclick = function () {
        location.reload();
      };

      // Back to edit button
      document.getElementById("backToEdit").onclick = function () {
        // Restore form values
        if (window.formValues) {
          document.getElementById("businessName").value =
            window.formValues.businessName || "";
          document.getElementById("customerName").value =
            window.formValues.customerName || "";
          document.getElementById("customerEmail").value =
            window.formValues.customerEmail || "";
          document.getElementById("customerPhone").value =
            window.formValues.customerPhone || "";
          document.getElementById("customerAddress").value =
            window.formValues.customerAddress || "";
          document.getElementById("docType").value =
            window.formValues.docType || "invoice";
          document.getElementById("invoiceNumber").value =
            window.formValues.invoiceNumber || "INV-001";
          document.getElementById("currencySelect").value =
            window.formValues.currency || "$";
          document.getElementById("dueDate").value =
            window.formValues.dueDate || "";
          document.getElementById("generatedBy").value =
            window.formValues.generatedBy || "";

          // Restore logo if exists
          if (window.formValues.logoSrc) {
            logoSrc = window.formValues.logoSrc;
            const img = document.getElementById("logoPreview");
            img.src = logoSrc;
            img.style.display = "block";
            document.getElementById("logoAlign").value =
              window.formValues.logoAlign || "left";
          } else {
            logoSrc = "";
            document.getElementById("logoPreview").style.display = "none";
            document.getElementById("logoAlign").value = "left";
          }

          // Restore products
          products = [...window.formValues.products];
          updateProductList();

          // Restore style selection
          selectedStyle = window.formValues.selectedStyle;
          initStyleOptions();
        }

        // Show the form again
        document.getElementById("invoiceOutput").style.display = "none";
        document.getElementById("appUI").style.display = "block";
        document.getElementById("printSection").style.display = "none";
      };

      // Initialize the page
      window.onload = function () {
        initStyleOptions();
      };
    </script>
  </body>
</html>
