<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Professional Invoice & Receipt Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f7f9fc;
        color: #333;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2,
      h3 {
        margin: 0 0 10px 0;
        color: #2c3e50;
      }
      h1 {
        text-align: center;
        font-size: 28px;
      }
      .subtitle {
        text-align: center;
        color: #7f8c8d;
        font-size: 15px;
        margin-bottom: 30px;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .form-group {
        margin-bottom: 18px;
      }
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #2c3e50;
        font-size: 14px;
      }
      input,
      select,
      button {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      th,
      td {
        border: 1px solid #000;
        padding: 10px;
        text-align: left;
      }
      th {
        background-color: #f8f9fa;
        color: #2c3e50;
      }
      .total-row td {
        font-weight: bold;
      }
      .logo-preview {
        max-width: 180px;
        margin-top: 10px;
        border: 1px solid #eee;
        border-radius: 8px;
      }
      .action-buttons {
        text-align: center;
        margin: 25px 0;
      }
      .action-buttons button {
        padding: 12px 24px;
        margin: 0 10px;
        width: auto;
        font-size: 16px;
      }
      .info-box {
        background: #d4edda;
        padding: 14px;
        border-radius: 8px;
        font-size: 14px;
        color: #155724;
        line-height: 1.5;
        margin-bottom: 15px;
        border: 1px solid #c3e6cb;
        font-weight: bold;
      }
      /* Customization Panel */
      .customization-panel {
        background: #f1f8ff;
        border-radius: 8px;
        padding: 20px;
        margin: 25px 0;
        border: 1px solid #d1e7ff;
      }
      .customization-section {
        margin-bottom: 20px;
      }
      .customization-section h3 {
        margin-top: 0;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 5px;
      }
      .customization-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }
      .style-option {
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        background: white;
      }
      .style-option:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .style-option.selected {
        border-color: #3498db;
        background-color: #e1f0fa;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
      }
      .style-preview {
        height: 100px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
      }
      .style-name {
        font-size: 14px;
        font-weight: 600;
      }
      .customization-description {
        font-size: 13px;
        color: #7f8c8d;
        margin-top: 5px;
        font-style: italic;
      }
      /* Color picker container */
      .color-picker-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .color-picker-wrapper {
        position: relative;
        width: 50px;
      }
      .color-reset-btn {
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 8px;
        cursor: pointer;
        font-size: 12px;
      }
      .color-reset-btn:hover {
        background: #c0392b;
      }
      /* Back Button */
      .back-button {
        background: #95a5a6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 10px;
        display: inline-flex;
        align-items: center;
      }
      .back-button:hover {
        background: #7f8c8d;
      }
      .back-button i {
        margin-right: 5px;
      }
      /* Remove Button */
      .remove-btn {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 5px;
      }
      .remove-btn:hover {
        background: #c0392b;
      }
      /* Print Styles */
      @media print {
        body * {
          visibility: hidden !important;
        }
        #invoiceOutput,
        #invoiceOutput * {
          visibility: visible !important;
        }
        #invoiceOutput {
          position: absolute !important;
          left: 0;
          top: 0;
          width: 100% !important;
          height: 100% !important;
          padding: 0 !important;
          margin: 0 !important;
          background: white !important;
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }
        @page {
          margin: 0;
          size: A4;
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  </head>
  <body>
    <!-- This will be printed -->
    <div
      id="invoiceOutput"
      style="display: none; width: 100%; min-height: 100vh"
    ></div>

    <!-- Main App -->
    <div id="appUI" class="container">
      <h1>üìÑ Professional Invoice & Receipt Generator</h1>
      <p class="subtitle">
        Create beautiful, customizable documents - no data stored
      </p>

      <!-- Business & Customer -->
      <div class="grid-2">
        <div>
          <h3>üíº Your Business</h3>
          <div class="form-group">
            <label>Business Name</label>
            <input type="text" id="businessName" placeholder="Your Company" />
          </div>
          <div class="form-group">
            <label>Business Slogan (Italic)</label>
            <input
              type="text"
              id="businessSlogan"
              placeholder="Your business motto"
            />
          </div>
          <div class="form-group">
            <label>Logo (Optional)</label>
            <input type="file" id="logoUpload" accept="image/*" />
            <img id="logoPreview" class="logo-preview" style="display: none" />
          </div>
          <div class="form-group">
            <label>Logo Alignment</label>
            <select id="logoAlign">
              <option value="left">Left</option>
              <option value="center">Center</option>
              <option value="right">Right</option>
            </select>
          </div>
        </div>
        <div>
          <h3>üì¨ Customer Details</h3>
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="customerName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              type="email"
              id="customerEmail"
              placeholder="john@example.com"
            />
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input
              type="text"
              id="customerPhone"
              placeholder="+234 801 234 5678"
            />
          </div>
          <div class="form-group">
            <label>Address</label>
            <input
              type="text"
              id="customerAddress"
              placeholder="Lagos, Nigeria"
            />
          </div>
        </div>
      </div>

      <!-- Business Details -->
      <div class="grid-2" style="margin: 25px 0">
        <div>
          <h3>üè¢ Business Address</h3>
          <div class="form-group">
            <label>Address Line 1</label>
            <input
              type="text"
              id="businessAddress1"
              placeholder="123 Business Street"
            />
          </div>
          <div class="form-group">
            <label>Address Line 2 (Optional)</label>
            <input type="text" id="businessAddress2" placeholder="Suite 456" />
          </div>
        </div>
        <div>
          <h3>üìû Contact Information</h3>
          <div class="form-group">
            <label>Business Phone</label>
            <input
              type="text"
              id="businessPhone"
              placeholder="+234 801 234 5678"
            />
          </div>
          <div class="form-group">
            <label>Business Email</label>
            <input
              type="email"
              id="businessEmail"
              placeholder="info@company.com"
            />
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div class="grid-2" style="margin: 25px 0">
        <div>
          <div class="form-group">
            <label>Document Type</label>
            <select id="docType">
              <option value="invoice">Invoice</option>
              <option value="receipt">Receipt</option>
            </select>
          </div>
          <div class="form-group">
            <label>Document Number</label>
            <input type="text" id="invoiceNumber" value="INV-001" />
          </div>
        </div>
        <div>
          <div class="form-group">
            <label>Currency</label>
            <select id="currencySelect">
              <option value="$">USD ($)</option>
              <option value="‚Ç¶">NGN (‚Ç¶)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Due Date (Invoice only)</label>
            <input type="date" id="dueDate" />
          </div>
        </div>
      </div>

      <!-- Bank Details Section (Only for Invoice) -->
      <div
        id="bankDetailsSection"
        style="
          display: none;
          background: #f8f9fa;
          padding: 20px;
          border-radius: 8px;
          margin: 20px 0;
        "
      >
        <h3>üè¶ Payment (Bank) Details</h3>
        <p>
          <strong>Enter your bank account information for invoices.</strong>
        </p>
        <div class="grid-2">
          <div class="form-group">
            <label>Account Name</label>
            <input type="text" id="accountName" placeholder="John Doe" />
          </div>
          <div class="form-group">
            <label>Account Number</label>
            <input type="text" id="accountNumber" placeholder="1234567890" />
          </div>
          <div class="form-group">
            <label>Bank Name</label>
            <input
              type="text"
              id="bankName"
              placeholder="First Bank of Nigeria"
            />
          </div>
        </div>
      </div>

      <!-- Add Product -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px">
        <h3>‚ûï Add Item</h3>
        <div
          style="display: grid; gap: 15px; grid-template-columns: 2fr 1fr 1fr"
        >
          <div>
            <label>Item</label>
            <input type="text" id="productName" placeholder="Web Design" />
          </div>
          <div>
            <label>Qty</label>
            <input type="number" id="productQty" value="1" min="1" />
          </div>
          <div>
            <label>Unit Price</label>
            <input
              type="number"
              id="productPrice"
              step="0.01"
              placeholder="5000"
            />
          </div>
        </div>
        <button id="addProduct" style="margin-top: 15px; width: 100%">
          ‚ûï Add to List
        </button>
      </div>

      <!-- Product Table -->
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Unit Price</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="productList"></tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="3" style="text-align: right">Total Amount:</td>
            <td id="totalAmount">$0.00</td>
          </tr>
        </tfoot>
      </table>

      <!-- Customization Panel -->
      <div class="customization-panel">
        <h3>üé® Document Customization</h3>
        <p>Customize your document appearance to match your brand identity</p>

        <!-- Style Selection -->
        <div class="customization-section">
          <h3>Style Presets</h3>
          <p>Select a professional style for your document:</p>
          <div class="customization-grid" id="styleOptions"></div>
          <button
            id="clearStyles"
            style="
              margin-top: 10px;
              padding: 8px 15px;
              background: #e74c3c;
              color: white;
              border: none;
              border-radius: 4px;
            "
          >
            Clear Selection
          </button>
        </div>

        <!-- Color Customization -->
        <div class="customization-section">
          <h3>Color Customization</h3>
          <p>Customize specific elements of your document</p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div>
              <label>Header Color</label>
              <div class="color-picker-container">
                <div class="color-picker-wrapper">
                  <input type="color" id="headerColor" value="#3498db" />
                </div>
                <button
                  class="color-reset-btn"
                  data-target="headerColor"
                  data-default="#3498db"
                >
                  Reset
                </button>
              </div>
              <div class="customization-description">
                Changes the color of document headers and titles
              </div>
            </div>
            <div>
              <label>Text Color</label>
              <div class="color-picker-container">
                <div class="color-picker-wrapper">
                  <input type="color" id="textColor" value="#2c3e50" />
                </div>
                <button
                  class="color-reset-btn"
                  data-target="textColor"
                  data-default="#2c3e50"
                >
                  Reset
                </button>
              </div>
              <div class="customization-description">
                Sets the main text color throughout the document
              </div>
            </div>
            <div>
              <label>Accent Color</label>
              <div class="color-picker-container">
                <div class="color-picker-wrapper">
                  <input type="color" id="accentColor" value="#1a3a6e" />
                </div>
                <button
                  class="color-reset-btn"
                  data-target="accentColor"
                  data-default="#1a3a6e"
                >
                  Reset
                </button>
              </div>
              <div class="customization-description">
                Used for important elements like totals and highlights
              </div>
            </div>
            <div>
              <label>Background Color</label>
              <div class="color-picker-container">
                <div class="color-picker-wrapper">
                  <input type="color" id="bgColor" value="#ffffff" />
                </div>
                <button
                  class="color-reset-btn"
                  data-target="bgColor"
                  data-default="#ffffff"
                >
                  Reset
                </button>
              </div>
              <div class="customization-description">
                Changes the overall document background color
              </div>
            </div>
            <div>
              <label>Border Color</label>
              <div class="color-picker-container">
                <div class="color-picker-wrapper">
                  <input type="color" id="borderColor" value="#000000" />
                </div>
                <button
                  class="color-reset-btn"
                  data-target="borderColor"
                  data-default="#000000"
                >
                  Reset
                </button>
              </div>
              <div class="customization-description">
                Sets the color of all document borders
              </div>
            </div>
          </div>
        </div>

        <!-- Font Customization -->
        <div class="customization-section">
          <h3>Typography</h3>
          <p>Choose fonts that match your brand style</p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div>
              <label>Font Family</label>
              <select id="fontFamily">
                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">
                  Segoe UI
                </option>
                <option value="'Helvetica Neue', Helvetica, Arial, sans-serif">
                  Helvetica Neue
                </option>
                <option value="'Times New Roman', Times, serif">
                  Times New Roman
                </option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Courier New, monospace">Courier New</option>
              </select>
              <div class="customization-description">
                Sets the primary font for all text in the document
              </div>
            </div>
            <div>
              <label>Header Font Size</label>
              <select id="headerSize">
                <option value="1.5em">Large</option>
                <option value="1.3em">Medium</option>
                <option value="1.1em">Small</option>
              </select>
              <div class="customization-description">
                Controls the size of document headings and titles
              </div>
            </div>
          </div>
        </div>

        <!-- Border Customization -->
        <div class="customization-section">
          <h3>Border Style</h3>
          <p>Customize the appearance of table and element borders</p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div>
              <label>Border Width</label>
              <select id="borderWidth">
                <option value="1px">Thin</option>
                <option value="2px" selected>Medium</option>
                <option value="3px">Thick</option>
              </select>
              <div class="customization-description">
                Controls the thickness of all document borders
              </div>
            </div>
            <div>
              <label>Border Style</label>
              <select id="borderStyle">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
              <div class="customization-description">
                Changes the visual style of document borders
              </div>
            </div>
          </div>
        </div>

        <!-- Footer Customization -->
        <div class="customization-section">
          <h3>Footer Message</h3>
          <p>Customize the thank you message at the bottom of your document</p>
          <div class="form-group">
            <label>Thank You Message</label>
            <input
              type="text"
              id="thankYouMessage"
              value="Thank you for your trust in building your software."
            />
            <div class="customization-description">
              This message appears at the bottom of your document
            </div>
          </div>
        </div>
      </div>

      <!-- Generated By -->
      <div class="form-group">
        <label>Generated By (Your Name)</label>
        <input type="text" id="generatedBy" placeholder="Jane Smith" />
      </div>

      <!-- Generate Button -->
      <div class="action-buttons">
        <button id="generateInvoice">üìÑ Generate Document</button>
      </div>
    </div>

    <!-- Print / PDF Section -->
    <div class="action-buttons" id="printSection" style="display: none">
      <div class="info-box">
        üéâ Your document is ready! Click below to print or download as PDF.
      </div>
      <button id="printInvoice" style="background: #27ae60">
        üñ®Ô∏è PRINT / SAVE AS PDF
      </button>
      <button id="downloadPdf" style="background: #2980b9">
        ‚¨áÔ∏è DOWNLOAD PDF
      </button>
      <button id="newInvoice" style="background: #95a5a6">
        üÜï NEW DOCUMENT
      </button>
      <button id="backToEdit" class="back-button">
        <i>‚Üê</i> Edit Information
      </button>
    </div>

    <script>
      let products = [];
      let logoSrc = "";
      let selectedStyle = -1;

      const styles = [
        {
          name: "Classic Blue",
          primary: "#3498db",
          secondary: "#2c3e50",
          accent: "#1a3a6e",
          background: "#ffffff",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Modern Green",
          primary: "#2ecc71",
          secondary: "#27ae60",
          accent: "#1e8449",
          background: "#f8f9fa",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Corporate Gray",
          primary: "#95a5a6",
          secondary: "#7f8c8d",
          accent: "#34495e",
          background: "#f5f5f5",
          font: "'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        {
          name: "Elegant Purple",
          primary: "#9b59b6",
          secondary: "#8e44ad",
          accent: "#7d3c98",
          background: "#f9f6ff",
          font: "'Times New Roman', Times, serif",
        },
        {
          name: "Warm Orange",
          primary: "#e67e22",
          secondary: "#d35400",
          accent: "#c0392b",
          background: "#fff5e6",
          font: "'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        {
          name: "Calm Teal",
          primary: "#1abc9c",
          secondary: "#16a085",
          accent: "#148f77",
          background: "#e8f8f5",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Royal Gold",
          primary: "#f1c40f",
          secondary: "#f39c12",
          accent: "#d35400",
          background: "#fff9e6",
          font: "'Georgia', serif",
        },
        {
          name: "Ocean Blue",
          primary: "#3498db",
          secondary: "#2980b9",
          accent: "#1a5276",
          background: "#eaf2f8",
          font: "'Times New Roman', Times, serif",
        },
        {
          name: "Sunset Red",
          primary: "#e74c3c",
          secondary: "#c0392b",
          accent: "#a93226",
          background: "#fdedec",
          font: "'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        {
          name: "Forest Green",
          primary: "#27ae60",
          secondary: "#219653",
          accent: "#1e8449",
          background: "#e8f8ee",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Dark Mode",
          primary: "#2c3e50",
          secondary: "#ffffff",
          accent: "#3498db",
          background: "#1a1a1a",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
        {
          name: "Light Mode",
          primary: "#2c3e50",
          secondary: "#000000",
          accent: "#3498db",
          background: "#ffffff",
          font: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
        },
      ];

      function initStyleOptions() {
        const container = document.getElementById("styleOptions");
        container.innerHTML = "";
        styles.forEach((style, index) => {
          const option = document.createElement("div");
          option.className = "style-option";
          if (index === selectedStyle) option.classList.add("selected");
          option.innerHTML = `
            <div class="style-preview" style="background: linear-gradient(135deg, ${style.primary}, ${style.secondary}); color: ${style.secondary}; background-color: ${style.background}">
              ${style.name}
            </div>
            <div class="style-name">${style.name}</div>
          `;
          option.addEventListener("click", () => {
            if (selectedStyle === index) {
              selectedStyle = -1;
              option.classList.remove("selected");
              return;
            }
            document
              .querySelectorAll(".style-option")
              .forEach((el) => el.classList.remove("selected"));
            option.classList.add("selected");
            selectedStyle = index;
            document.getElementById("headerColor").value = style.primary;
            document.getElementById("textColor").value = style.secondary;
            document.getElementById("accentColor").value = style.accent;
            document.getElementById("bgColor").value = style.background;
            document.getElementById("fontFamily").value = style.font;
          });
          container.appendChild(option);
        });
      }

      document
        .getElementById("clearStyles")
        .addEventListener("click", function () {
          selectedStyle = -1;
          document
            .querySelectorAll(".style-option")
            .forEach((el) => el.classList.remove("selected"));
        });

      document.querySelectorAll(".color-reset-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          const target = this.getAttribute("data-target");
          const defaultValue = this.getAttribute("data-default");
          document.getElementById(target).value = defaultValue;
          selectedStyle = -1;
          document
            .querySelectorAll(".style-option")
            .forEach((el) => el.classList.remove("selected"));
        });
      });

      // Toggle bank details visibility
      function toggleBankDetails() {
        const docType = document.getElementById("docType").value;
        const bankSection = document.getElementById("bankDetailsSection");
        bankSection.style.display = docType === "invoice" ? "block" : "none";
      }

      document
        .getElementById("docType")
        .addEventListener("change", toggleBankDetails);

      // Logo Preview
      document
        .getElementById("logoUpload")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
              logoSrc = event.target.result;
              const img = document.getElementById("logoPreview");
              img.src = logoSrc;
              img.style.display = "block";
            };
            reader.readAsDataURL(file);
          }
        });

      // Add Product
      document
        .getElementById("addProduct")
        .addEventListener("click", function () {
          const name = document.getElementById("productName").value.trim();
          const qty = parseInt(document.getElementById("productQty").value);
          const price = parseFloat(
            document.getElementById("productPrice").value
          );
          if (!name || isNaN(qty) || qty <= 0 || isNaN(price) || price < 0) {
            alert("Please fill all fields correctly.");
            return;
          }
          const itemTotal = qty * price;
          products.push({ name, qty, price, itemTotal });
          updateProductList();
          clearForm();
        });

      function updateProductList() {
        const tbody = document.getElementById("productList");
        tbody.innerHTML = "";
        let total = 0;
        products.forEach((p, index) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${escapeHtml(p.name)}</td>
            <td>${p.qty}</td>
            <td>${getCurrency()}${p.price.toFixed(2)}</td>
            <td>${getCurrency()}${p.itemTotal.toFixed(2)}</td>
            <td><button class="remove-btn" data-index="${index}">Remove</button></td>
          `;
          tbody.appendChild(tr);
          total += p.itemTotal;
        });
        document.getElementById(
          "totalAmount"
        ).textContent = `${getCurrency()}${total.toFixed(2)}`;

        document.querySelectorAll(".remove-btn").forEach((button) => {
          button.addEventListener("click", function () {
            const index = parseInt(this.getAttribute("data-index"));
            if (confirm("Are you sure you want to remove this item?")) {
              products.splice(index, 1);
              updateProductList();
            }
          });
        });
      }

      function clearForm() {
        document.getElementById("productName").value = "";
        document.getElementById("productQty").value = "1";
        document.getElementById("productPrice").value = "";
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function getCurrency() {
        return document.getElementById("currencySelect").value;
      }

      function formatDate(dateStr) {
        if (!dateStr) return null;
        return new Date(dateStr).toLocaleDateString("en-NG", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Generate Document
      document
        .getElementById("generateInvoice")
        .addEventListener("click", function () {
          if (products.length === 0) {
            alert("Please add at least one item.");
            return;
          }

          window.formValues = {
            businessName: document.getElementById("businessName").value,
            businessSlogan: document.getElementById("businessSlogan").value,
            businessAddress1: document.getElementById("businessAddress1").value,
            businessAddress2: document.getElementById("businessAddress2").value,
            businessPhone: document.getElementById("businessPhone").value,
            businessEmail: document.getElementById("businessEmail").value,
            customerName: document.getElementById("customerName").value,
            customerEmail: document.getElementById("customerEmail").value,
            customerPhone: document.getElementById("customerPhone").value,
            customerAddress: document.getElementById("customerAddress").value,
            docType: document.getElementById("docType").value,
            invoiceNumber: document.getElementById("invoiceNumber").value,
            currency: getCurrency(),
            dueDate: document.getElementById("dueDate").value,
            generatedBy: document.getElementById("generatedBy").value,
            logoSrc: logoSrc,
            logoAlign: document.getElementById("logoAlign").value,
            products: [...products],
            selectedStyle: selectedStyle,
            thankYouMessage: document.getElementById("thankYouMessage").value,
            accountName: document.getElementById("accountName").value,
            accountNumber: document.getElementById("accountNumber").value,
            bankName: document.getElementById("bankName").value,
          };

          const borderColor =
            document.getElementById("borderColor").value || "#000000";
          const headerColor =
            document.getElementById("headerColor").value ||
            (selectedStyle !== -1 ? styles[selectedStyle].primary : "#3498db");
          const textColor =
            document.getElementById("textColor").value ||
            (selectedStyle !== -1
              ? styles[selectedStyle].secondary
              : "#2c3e50");
          const accentColor =
            document.getElementById("accentColor").value ||
            (selectedStyle !== -1 ? styles[selectedStyle].accent : "#1a3a6e");
          const bgColor =
            document.getElementById("bgColor").value ||
            (selectedStyle !== -1
              ? styles[selectedStyle].background
              : "#ffffff");
          const fontFamily = document.getElementById("fontFamily").value;
          const headerSize = document.getElementById("headerSize").value;
          const borderWidth = document.getElementById("borderWidth").value;
          const borderStyle = document.getElementById("borderStyle").value;
          const thankYouMessage =
            document.getElementById("thankYouMessage").value ||
            "Thank you for your trust in building your software.";
          const business =
            document.getElementById("businessName").value || "Your Business";
          const businessSlogan =
            document.getElementById("businessSlogan").value || "";
          const businessAddress1 =
            document.getElementById("businessAddress1").value || "";
          const businessAddress2 =
            document.getElementById("businessAddress2").value || "";
          const businessPhone =
            document.getElementById("businessPhone").value || "";
          const businessEmail =
            document.getElementById("businessEmail").value || "";
          const customerName =
            document.getElementById("customerName").value || "Client";
          const customerEmail =
            document.getElementById("customerEmail").value || "";
          const customerPhone =
            document.getElementById("customerPhone").value || "";
          const customerAddress =
            document.getElementById("customerAddress").value || "";
          const generatedBy =
            document.getElementById("generatedBy").value || "";
          const currency = getCurrency();
          const docType = document.getElementById("docType").value;
          const invoiceNumber =
            document.getElementById("invoiceNumber").value || "INV-001";
          const dueDate = formatDate(document.getElementById("dueDate").value);
          const issueDate = new Date().toLocaleDateString("en-NG", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          let logoHtml = "";
          if (logoSrc) {
            const logoAlign = document.getElementById("logoAlign").value;
            const alignmentStyle =
              logoAlign === "left"
                ? "text-align:left;"
                : logoAlign === "center"
                ? "text-align:center;"
                : "text-align:right;";
            logoHtml = `<div style="${alignmentStyle}margin-bottom:15px;"><img src="${logoSrc}" style="max-width:180px;border-radius:8px;"></div>`;
          }

          let businessDetails = `<h1 style="text-align:center;margin:0;color:${headerColor};">${escapeHtml(
            business
          )}</h1>`;
          if (businessSlogan) {
            businessDetails += `<p style="text-align:center;margin:5px 0;font-style:italic;color:${textColor};">${escapeHtml(
              businessSlogan
            )}</p>`;
          }
          let addressParts = [];
          if (businessAddress1) addressParts.push(escapeHtml(businessAddress1));
          if (businessAddress2) addressParts.push(escapeHtml(businessAddress2));
          if (businessPhone) addressParts.push(escapeHtml(businessPhone));
          if (businessEmail) addressParts.push(escapeHtml(businessEmail));
          if (addressParts.length > 0) {
            businessDetails += `<p style="text-align:center;margin:5px 0;color:${textColor};">${addressParts.join(
              " | "
            )}</p>`;
          }

          let customerHtml = `<strong>${escapeHtml(customerName)}</strong><br>`;
          if (customerAddress)
            customerHtml += `${escapeHtml(customerAddress)}<br>`;
          if (customerEmail) customerHtml += `${escapeHtml(customerEmail)}<br>`;
          if (customerPhone) customerHtml += `${escapeHtml(customerPhone)}<br>`;

          const docTitle = docType === "receipt" ? "RECEIPT" : "INVOICE";
          const docNumberLabel =
            docType === "receipt" ? "Receipt No" : "Invoice No";
          const dueHtml =
            docType === "invoice" && dueDate
              ? `<p><strong>Due Date:</strong> ${dueDate}</p>`
              : "";

          // Bank details (only for invoice)
          let bankHtml = "";
          if (docType === "invoice") {
            const accountName =
              document.getElementById("accountName").value || "";
            const accountNumber =
              document.getElementById("accountNumber").value || "";
            const bankName = document.getElementById("bankName").value || "";
            if (accountName || accountNumber || bankName) {
              bankHtml = `
              <p><strong>Pay To:</strong></p>
              <p>
                ${
                  accountName
                    ? `<strong>Account Name:</strong> ${escapeHtml(
                        accountName
                      )}<br>`
                    : ""
                }
                ${
                  accountNumber
                    ? `<strong>Account Number:</strong> ${escapeHtml(
                        accountNumber
                      )}<br>`
                    : ""
                }
                ${
                  bankName
                    ? `<strong>Bank Name:</strong> ${escapeHtml(bankName)}<br>`
                    : ""
                }
              </p>
            `;
            }
          }

          let itemsHtml = "";
          const total = products.reduce((sum, p) => sum + p.itemTotal, 0);
          products.forEach((p, index) => {
            itemsHtml += `<tr>
            <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${escapeHtml(
              p.name
            )}</td>
            <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${
              p.qty
            }</td>
            <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${currency}${p.price.toFixed(
              2
            )}</td>
            <td style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">${currency}${p.itemTotal.toFixed(
              2
            )}</td>
          </tr>`;
          });

          const output = document.getElementById("invoiceOutput");
          output.innerHTML = `
          <div style="font-family:${fontFamily};color:${textColor};max-width:900px;margin:auto;padding:20px;background:${bgColor};min-height:100vh;">
            ${logoHtml}
            ${businessDetails}
            <h1 style="text-align:center;color:${headerColor};font-weight:bold;font-size:${headerSize};">${docTitle}</h1>
            <table width="100%" style="margin-bottom:20px;border-collapse:collapse;border:${borderWidth} ${borderStyle} ${borderColor};">
              <tr>
                <td width="50%" style="border:${borderWidth} ${borderStyle} ${borderColor}; padding:14px;">
                  <strong style="color:${textColor};">${docNumberLabel}:</strong> ${escapeHtml(
            invoiceNumber
          )}<br>
                  <strong style="color:${textColor};">Date:</strong> ${issueDate}<br>${dueHtml}${bankHtml}
                </td>
                <td width="50%" style="border:${borderWidth} ${borderStyle} ${borderColor}; padding:14px; text-align:right;">
                  <strong style="color:${textColor};">Billed To:</strong><br>${customerHtml}
                </td>
              </tr>
            </table>
            <table style="width:100%;border-collapse:collapse;border:${borderWidth} ${borderStyle} ${borderColor};">
              <thead>
                <tr style="background:${headerColor};color:white;">
                  <th style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">Item</th>
                  <th style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">Qty</th>
                  <th style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">Unit Price</th>
                  <th style="padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">Total</th>
                </tr>
              </thead>
              <tbody>${itemsHtml}</tbody>
              <tfoot>
                <tr>
                  <td colspan="3" style="text-align:right;font-weight:bold;font-size:1.3em;padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};">Total:</td>
                  <td style="font-weight:bold;font-size:1.4em;padding:14px;border:${borderWidth} ${borderStyle} ${borderColor};color:${accentColor};">${currency}${total.toFixed(
            2
          )}</td>
                </tr>
              </tfoot>
            </table>
            ${
              generatedBy
                ? `<p style="text-align:center;margin-top:30px;font-style:italic;color:${textColor};">
              Document Created By: ${escapeHtml(generatedBy)}<br>
              Date: ${issueDate}
            </p>`
                : ""
            }
            <p style="text-align:center;margin-top:10px;font-size:0.9em;color:${textColor};">
              ${thankYouMessage}
            </p>
          </div>
        `;

          document.getElementById("appUI").style.display = "none";
          document.getElementById("invoiceOutput").style.display = "block";
          document.getElementById("printSection").style.display = "block";
          document
            .getElementById("printSection")
            .scrollIntoView({ behavior: "smooth" });
        });

      // Print button
      document.getElementById("printInvoice").onclick = function () {
        window.print();
      };

      // Download PDF button
      document.getElementById("downloadPdf").onclick = function () {
        const invoice = document.getElementById("invoiceOutput");
        const bgColor =
          document.getElementById("bgColor").value ||
          (selectedStyle !== -1 ? styles[selectedStyle].background : "#ffffff");
        invoice.style.minHeight = "100vh";
        invoice.style.background = bgColor;
        const opt = {
          margin: 0,
          filename: "document.pdf",
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: {
            scale: 2,
            backgroundColor: bgColor,
            useCORS: true,
          },
          jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
          pagebreak: { mode: ["avoid-all", "css", "legacy"] },
        };
        html2pdf()
          .set(opt)
          .from(invoice)
          .save()
          .then(() => {
            invoice.style.minHeight = "";
            invoice.style.background = "";
          });
      };

      // New document
      document.getElementById("newInvoice").onclick = function () {
        location.reload();
      };

      // Back to edit
      document.getElementById("backToEdit").onclick = function () {
        if (window.formValues) {
          document.getElementById("businessName").value =
            window.formValues.businessName || "";
          document.getElementById("businessSlogan").value =
            window.formValues.businessSlogan || "";
          document.getElementById("businessAddress1").value =
            window.formValues.businessAddress1 || "";
          document.getElementById("businessAddress2").value =
            window.formValues.businessAddress2 || "";
          document.getElementById("businessPhone").value =
            window.formValues.businessPhone || "";
          document.getElementById("businessEmail").value =
            window.formValues.businessEmail || "";
          document.getElementById("customerName").value =
            window.formValues.customerName || "";
          document.getElementById("customerEmail").value =
            window.formValues.customerEmail || "";
          document.getElementById("customerPhone").value =
            window.formValues.customerPhone || "";
          document.getElementById("customerAddress").value =
            window.formValues.customerAddress || "";
          document.getElementById("docType").value =
            window.formValues.docType || "invoice";
          document.getElementById("invoiceNumber").value =
            window.formValues.invoiceNumber || "INV-001";
          document.getElementById("currencySelect").value =
            window.formValues.currency || "$";
          document.getElementById("dueDate").value =
            window.formValues.dueDate || "";
          document.getElementById("generatedBy").value =
            window.formValues.generatedBy || "";
          document.getElementById("thankYouMessage").value =
            window.formValues.thankYouMessage ||
            "Thank you for your trust in building your software.";
          document.getElementById("accountName").value =
            window.formValues.accountName || "";
          document.getElementById("accountNumber").value =
            window.formValues.accountNumber || "";
          document.getElementById("bankName").value =
            window.formValues.bankName || "";

          if (window.formValues.logoSrc) {
            logoSrc = window.formValues.logoSrc;
            const img = document.getElementById("logoPreview");
            img.src = logoSrc;
            img.style.display = "block";
            document.getElementById("logoAlign").value =
              window.formValues.logoAlign || "left";
          } else {
            logoSrc = "";
            document.getElementById("logoPreview").style.display = "none";
            document.getElementById("logoAlign").value = "left";
          }

          products = [...window.formValues.products];
          updateProductList();
          selectedStyle = window.formValues.selectedStyle;
          initStyleOptions();
          toggleBankDetails(); // Update bank section visibility
        }

        document.getElementById("invoiceOutput").style.display = "none";
        document.getElementById("appUI").style.display = "block";
        document.getElementById("printSection").style.display = "none";
      };

      // Initialize the page
      window.onload = function () {
        initStyleOptions();
        toggleBankDetails(); // Initial check
      };
    </script>
  </body>
</html>
